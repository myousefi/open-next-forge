---
title: Storage
description: How to store files in your application.
---

next-forge has a `storage` package that provides a simple wrapper around Cloudflare R2 for file storage.

## Usage

### Server uploads

Configure the following environment variables so the server wrapper can authenticate with R2:

- `CLOUDFLARE_R2_ACCOUNT_ID`
- `CLOUDFLARE_R2_ACCESS_KEY_ID`
- `CLOUDFLARE_R2_SECRET_ACCESS_KEY`
- `CLOUDFLARE_R2_BUCKET_NAME`
- `CLOUDFLARE_R2_PUBLIC_BASE_URL` (optional, set to your custom domain to return permanent public URLs)

```tsx title="page.tsx"
import { put } from '@repo/storage';
import { revalidatePath } from 'next/cache';

export async function Form() {
  async function uploadImage(formData: FormData) {
    'use server';
    const imageFile = formData.get('image') as File;
    const object = await put(`images/${imageFile.name}`, imageFile, {
      contentType: imageFile.type,
      makePublic: true,
    });
    revalidatePath('/');
    return object;
  }
 
  return (
    <form action={uploadImage}>
      <label htmlFor="image">Image</label>
      <input type="file" id="image" name="image" required />
      <button>Upload</button>
    </form>
  );
}
```

<Tip>If you need to upload files larger than 4.5 MB, consider using client uploads.</Tip>

### Client uploads

Expose an upload endpoint (for example, in a Worker) and set its URL in `NEXT_PUBLIC_STORAGE_UPLOAD_URL`. The client helper will post files there with multipart form data for you.

```tsx title="page.tsx"
'use client';

import { type PutObjectResult } from '@repo/storage';
import { upload } from '@repo/storage/client';
import { useState, useRef } from 'react';

export default function AvatarUploadPage() {
  const inputFileRef = useRef<HTMLInputElement>(null);
  const [object, setObject] = useState<PutObjectResult | null>(null);
  return (
    <>
      <h1>Upload Your Avatar</h1>

      <form
        onSubmit={async (event) => {
          event.preventDefault();

          if (!inputFileRef.current?.files) {
            throw new Error('No file selected');
          }

          const file = inputFileRef.current.files[0];

          const newObject = await upload(file, {
            key: `avatars/${file.name}`,
            contentType: file.type,
            makePublic: true,
          });

          setObject(newObject);
        }}
      >
        <input name="file" ref={inputFileRef} type="file" required />
        <button type="submit">Upload</button>
      </form>
      {object && (
        <div>
          Object url: <a href={object.url}>{object.url}</a>
        </div>
      )}
    </>
  );
}
```
